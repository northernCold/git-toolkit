# GRM ä½¿ç”¨æŒ‡å—

GRM (Git Release Manager) æ˜¯ä¸€ä¸ª Git å‘ç‰ˆå·¥ä½œæµè‡ªåŠ¨åŒ– CLI å·¥å…·ã€‚

## å®‰è£…

### æ–¹å¼ä¸€ï¼šå…¨å±€é“¾æ¥ï¼ˆæ¨èå¼€å‘æ—¶ä½¿ç”¨ï¼‰

```bash
cd packages/git-release-manager
pnpm install
pnpm build
npm link --global
```

å®‰è£…å®Œæˆåï¼Œå¯åœ¨ä»»æ„ Git ä»“åº“ä¸­ä½¿ç”¨ `gtk` å‘½ä»¤ã€‚

### æ–¹å¼äºŒï¼šå…¨å±€å®‰è£…

```bash
cd packages/git-release-manager
pnpm install
pnpm build
npm install -g .
```

### æ–¹å¼ä¸‰ï¼šå¼€å‘æ¨¡å¼ç›´æ¥è¿è¡Œ

```bash
cd packages/git-release-manager
pnpm install
pnpm dev release start 1.0.0
```

## å‘½ä»¤ä¸€è§ˆ

| å‘½ä»¤ | æè¿° |
|:---|:---|
| `gtk release start <version>` | åˆå§‹åŒ–å‘ç‰ˆåˆ†æ”¯å¹¶åˆå¹¶åŠŸèƒ½ |
| `gtk release pre` | éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ |
| `gtk release prod` | æ­£å¼å‘ç‰ˆæ‰“æ ‡ |
| `gtk release finish` | å®Œæˆå‘ç‰ˆå¹¶æ¸…ç† |

## å®Œæ•´å‘ç‰ˆæµç¨‹

### 1. å¼€å§‹å‘ç‰ˆ

```bash
gtk release start 1.2.0
```

**æ‰§è¡Œæ­¥éª¤ï¼š**
1. æ£€æŸ¥å·¥ä½œåŒºæ˜¯å¦å¹²å‡€
2. æ‹‰å–è¿œç¨‹æœ€æ–°ä¿¡æ¯ (`git fetch origin`)
3. æ›´æ–° master åˆ†æ”¯
4. åˆ›å»ºå‘å¸ƒåˆ†æ”¯ `p/1.2.0`
5. äº¤äº’å¼é€‰æ‹©è¦åˆå¹¶çš„åŠŸèƒ½åˆ†æ”¯
6. ä¾æ¬¡åˆå¹¶é€‰ä¸­çš„åŠŸèƒ½åˆ†æ”¯
7. æ¨é€å‘å¸ƒåˆ†æ”¯åˆ°è¿œç¨‹

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â”Œ  å¼€å§‹å‘ç‰ˆ 1.2.0
â”‚
â—‡  å·¥ä½œåŒºå¹²å‡€ âœ“
â—‡  è¿œç¨‹åŒæ­¥å®Œæˆ âœ“
â—‡  master åˆ†æ”¯å·²æ›´æ–° âœ“
â—‡  å‘å¸ƒåˆ†æ”¯ p/1.2.0 å·²åˆ›å»º âœ“
â”‚
â—†  é€‰æ‹©è¦åˆå¹¶çš„åŠŸèƒ½åˆ†æ”¯:
â”‚  â—‹ feature/login
â”‚  â—‹ feature/dashboard
â”‚  â—‹ fix/bug-123
â”‚
â—‡  feature/login åˆå¹¶æˆåŠŸ âœ“
â—‡  feature/dashboard åˆå¹¶æˆåŠŸ âœ“
â—‡  p/1.2.0 å·²æ¨é€åˆ°è¿œç¨‹ âœ“
â”‚
â””  âœ“ å‘ç‰ˆåˆ†æ”¯ p/1.2.0 å‡†å¤‡å®Œæˆï¼
```

### 2. éƒ¨ç½²é¢„ç”Ÿäº§ç¯å¢ƒ

```bash
gtk release pre
```

> âš ï¸ å¿…é¡»åœ¨å‘å¸ƒåˆ†æ”¯ (p/xxx) ä¸Šæ‰§è¡Œ

**æ‰§è¡Œæ­¥éª¤ï¼š**
1. æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨å‘å¸ƒåˆ†æ”¯
2. åˆ‡æ¢åˆ° `pre` åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°
3. åˆå¹¶å‘å¸ƒåˆ†æ”¯åˆ° `pre`
4. æ¨é€ `pre` åˆ†æ”¯
5. åˆ‡å›å‘å¸ƒåˆ†æ”¯
6. æç¤ºè®¿é—® Jenkins æ„å»º

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â”Œ  éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ
â”‚
â—‡  å·¥ä½œåŒºå¹²å‡€ âœ“
â—‡  å½“å‰å‘å¸ƒåˆ†æ”¯: p/1.2.0 âœ“
â—‡  å·²åˆ‡æ¢åˆ° pre åˆ†æ”¯ âœ“
â—‡  pre åˆ†æ”¯å·²æ›´æ–° âœ“
â—‡  p/1.2.0 åˆå¹¶æˆåŠŸ âœ“
â—‡  pre åˆ†æ”¯å·²æ¨é€åˆ°è¿œç¨‹ âœ“
â—‡  å·²åˆ‡å› p/1.2.0 âœ“
â”‚
â””  âœ“ é¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‡†å¤‡å®Œæˆï¼

â”Œ  Jenkins æ„å»º
â”‚
â”‚  è¯·è®¿é—® Jenkins æ„å»º pre åˆ†æ”¯:
â”‚  http://10.255.254.23:8080/job/popjoy/
â”‚
â”‚  éªŒæ”¶é€šè¿‡åæ‰§è¡Œ: gtk release prod
â”‚
â””
```

### 3. æ­£å¼å‘ç‰ˆæ‰“æ ‡

```bash
gtk release prod
```

> âš ï¸ å¿…é¡»åœ¨å‘å¸ƒåˆ†æ”¯ (p/xxx) ä¸Šæ‰§è¡Œ

**æ‰§è¡Œæ­¥éª¤ï¼š**
1. æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨å‘å¸ƒåˆ†æ”¯
2. ç¡®è®¤æ˜¯å¦åˆ›å»ºæ­£å¼ Tag
3. åˆ›å»ºå¸¦æ³¨é‡Šçš„ Tag (`v1.2.0`)
4. æ¨é€ Tag åˆ°è¿œç¨‹
5. æç¤ºè®¿é—® Jenkins éƒ¨ç½²ç”Ÿäº§

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â”Œ  æ­£å¼å‘ç‰ˆæ‰“æ ‡
â”‚
â—‡  å·¥ä½œåŒºå¹²å‡€ âœ“
â—‡  å½“å‰å‘å¸ƒåˆ†æ”¯: p/1.2.0, ç‰ˆæœ¬: 1.2.0 âœ“
â”‚
â—†  ç¡®è®¤è¦ä¸ºç‰ˆæœ¬ 1.2.0 åˆ›å»ºæ­£å¼å‘å¸ƒ Tag å—?
â”‚  â— Yes / â—‹ No
â”‚
â—‡  Tag v1.2.0 åˆ›å»ºæˆåŠŸ âœ“
â—‡  Tag v1.2.0 å·²æ¨é€åˆ°è¿œç¨‹ âœ“
â”‚
â””  âœ“ æ­£å¼å‘ç‰ˆ v1.2.0 å®Œæˆï¼

â”Œ  Jenkins æ„å»º (ç”Ÿäº§)
â”‚
â”‚  è¯·è®¿é—® Jenkins æ„å»º Tag v1.2.0 éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ:
â”‚  http://10.255.254.23:8080/job/popjoy/
â”‚
â”‚  éƒ¨ç½²æˆåŠŸåæ‰§è¡Œ: gtk release finish
â”‚
â””
```

### 4. å®Œæˆå‘ç‰ˆ

```bash
gtk release finish
```

> âš ï¸ å¿…é¡»åœ¨å‘å¸ƒåˆ†æ”¯ (p/xxx) ä¸Šæ‰§è¡Œ

**æ‰§è¡Œæ­¥éª¤ï¼š**
1. åˆ‡æ¢åˆ° master åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°
2. ä½¿ç”¨ `--no-ff` åˆå¹¶å‘å¸ƒåˆ†æ”¯ï¼ˆä¿ç•™åˆå¹¶èŠ‚ç‚¹ï¼‰
3. æ¨é€ master åˆ†æ”¯
4. äº¤äº’å¼ç¡®è®¤æ˜¯å¦åˆ é™¤å‘å¸ƒåˆ†æ”¯
5. äº¤äº’å¼é€‰æ‹©è¦æ¸…ç†çš„åŠŸèƒ½åˆ†æ”¯

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
â”Œ  å®Œæˆå‘ç‰ˆå¹¶æ¸…ç†
â”‚
â—‡  å·¥ä½œåŒºå¹²å‡€ âœ“
â—‡  å½“å‰å‘å¸ƒåˆ†æ”¯: p/1.2.0 âœ“
â—‡  å·²åˆ‡æ¢åˆ° master åˆ†æ”¯ âœ“
â—‡  master åˆ†æ”¯å·²æ›´æ–° âœ“
â—‡  p/1.2.0 åˆå¹¶æˆåŠŸ (--no-ff) âœ“
â—‡  master åˆ†æ”¯å·²æ¨é€åˆ°è¿œç¨‹ âœ“
â”‚
â—†  æ˜¯å¦åˆ é™¤å‘å¸ƒåˆ†æ”¯ p/1.2.0?
â”‚  â— Yes / â—‹ No
â”‚
â—‡  æœ¬åœ°åˆ†æ”¯ p/1.2.0 å·²åˆ é™¤ âœ“
â—‡  è¿œç¨‹åˆ†æ”¯ p/1.2.0 å·²åˆ é™¤ âœ“
â”‚
â—†  é€‰æ‹©è¦åˆ é™¤çš„å·²åˆå¹¶åŠŸèƒ½åˆ†æ”¯:
â”‚  â—‹ feature/login
â”‚  â—‹ feature/dashboard
â”‚
â””  âœ“ å‘ç‰ˆ v1.2.0 æµç¨‹å·²å®Œæˆï¼
```

## å¼‚å¸¸å¤„ç†

### åˆå¹¶å†²çª

å½“åˆå¹¶è¿‡ç¨‹ä¸­å‘ç”Ÿå†²çªæ—¶ï¼Œå·¥å…·ä¼šåœæ­¢å¹¶æç¤ºï¼š

```
â”Œ  åˆå¹¶å†²çª
â”‚
â”‚  è¯·æ‰‹åŠ¨è§£å†³å†²çªåæ‰§è¡Œ:
â”‚    git add .
â”‚    git commit
â”‚  ç„¶åé‡æ–°è¿è¡Œæ­¤å‘½ä»¤
â”‚
â””
```

è§£å†³æ­¥éª¤ï¼š
1. æ‰‹åŠ¨è§£å†³å†²çªæ–‡ä»¶
2. `git add .`
3. `git commit`
4. é‡æ–°è¿è¡Œå½“å‰å‘½ä»¤

### å·¥ä½œåŒºä¸å¹²å‡€

å¦‚æœæœ‰æœªæäº¤çš„æ”¹åŠ¨ï¼Œå·¥å…·ä¼šæ‹’ç»æ‰§è¡Œå¹¶æç¤ºï¼š

```
âœ–  å·¥ä½œåŒºæœ‰æœªæäº¤çš„æ”¹åŠ¨ï¼Œè¯·å…ˆæäº¤æˆ–æš‚å­˜
```

è§£å†³æ­¥éª¤ï¼š
- æäº¤æ”¹åŠ¨ï¼š`git add . && git commit -m "message"`
- æˆ–æš‚å­˜æ”¹åŠ¨ï¼š`git stash`

### åˆ†æ”¯æ£€æŸ¥å¤±è´¥

å¦‚æœä¸åœ¨æ­£ç¡®çš„åˆ†æ”¯ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š

```
âœ–  å½“å‰åˆ†æ”¯ master ä¸æ˜¯å‘å¸ƒåˆ†æ”¯ (p/xxx)ï¼Œè¯·å…ˆåˆ‡æ¢åˆ°å‘å¸ƒåˆ†æ”¯
```

è§£å†³æ­¥éª¤ï¼š
- åˆ‡æ¢åˆ°æ­£ç¡®çš„å‘å¸ƒåˆ†æ”¯ï¼š`git checkout p/1.2.0`

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

GRM æ”¯æŒé€šè¿‡ `.env` æ–‡ä»¶é…ç½®ç¯å¢ƒå˜é‡ã€‚

**åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š**

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®
vim .env
```

**ç¤ºä¾‹ `.env` æ–‡ä»¶ï¼š**

```bash
# Jenkins é…ç½®
JENKINS_URL=http://10.255.254.23:8080/job/popjoy/
```

**é…ç½®åŠ è½½é¡ºåºï¼š**
1. ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
2. å½“å‰å·¥ä½œç›®å½•çš„ `.env` æ–‡ä»¶
3. GRM å®‰è£…ç›®å½•çš„ `.env` æ–‡ä»¶

> ğŸ’¡ å¦‚æœæœªé…ç½® `JENKINS_URL`ï¼Œå‘½ä»¤æ‰§è¡Œåä¼šæ˜¾ç¤ºé€šç”¨æç¤ºè€Œé Jenkins é“¾æ¥ã€‚

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼Ÿ

```bash
gtk --help
gtk release --help
gtk release start --help
```

### Q: å¦‚ä½•æŸ¥çœ‹ç‰ˆæœ¬å·ï¼Ÿ

```bash
gtk --version
```

### Q: å‘å¸ƒåˆ†æ”¯å‘½åè§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

å‘å¸ƒåˆ†æ”¯ä½¿ç”¨ `p/<version>` æ ¼å¼ï¼Œä¾‹å¦‚ `p/1.2.0`ã€‚

### Q: Tag å‘½åè§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

Tag ä½¿ç”¨ `v<version>` æ ¼å¼ï¼Œä¾‹å¦‚ `v1.2.0`ã€‚

